#!/usr/bin/env bash
set -euo pipefail
# comfy-remote â€” always exposes repo/src on PYTHONPATH and runs the pure launcher.

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
SRC="$ROOT/src"

if [[ ! -f "$SRC/comfyui_remote/bin/comfy_server.py" ]]; then
  echo "[ERROR] Could not find src/comfyui_remote/bin/comfy_server.py near $SCRIPT_DIR"
  echo "        Expected: $SRC"
  exit 2
fi

export PYTHONPATH="$SRC:${PYTHONPATH:-}"

# Optional: pin interpreter with COMFY_REMOTE_PY
if [[ -n "${COMFY_REMOTE_PY:-}" && -x "${COMFY_REMOTE_PY:-}" ]]; then
  exec "$COMFY_REMOTE_PY" -m comfyui_remote.bin.comfy_server "$@"
fi

if command -v python3 >/dev/null 2>&1; then
  exec python3 -m comfyui_remote.bin.comfy_server "$@"
fi

exec python -m comfyui_remote.bin.comfy_server "$@"
